<mashup name="TreaturyHAMPModCounter" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openmashup.org/schemas/v1.0/EMML ../schemas/EMMLPrestoSpec.xsd" xmlns="http://www.openmashup.org/schemas/v1.0/EMML" xmlns:macro="http://www.openmashup.org/schemas/v1.0/EMMLMacro" xmlns:presto="http://www.jackbe.com/v1.0/EMMLPrestoExtensions" >
<operation name="runMashup" >

<namespaces></namespaces>
<variable name="limitRecords" type="number" default="-2"/>
<presto:presto-meta wires_id="" name="prestoMeta_createdBy"  >Wires</presto:presto-meta>
<presto:presto-meta wires_id="" name="prestoMeta_state"  ><![CDATA[{}]]></presto:presto-meta>
<presto:presto-meta wires_id="" name="prestoMeta_customProperties"  ><![CDATA[{"SQL_1":{"label":"SQL","datasourceName":"BigData","sqlCommand":"select distinct prop_geoc_cnsus_msa_cd from TreasuryHAMP where prop_geoc_cnsus_msa_cd > 1;","startRow":1,"rowCount":"3","fetchSize":"3","datasourceDetails":[{"maxIdle":null,"validationCallTimeout":null,"state":"AVAILABLE","validationQuery":"","jdbcDriverName":"HSQL","password":"presto","maxActive":null,"poolPreparedStatements":false,"numTestsPerEvictionRun":null,"userId":"presto","name":"BigData","maxWait":null,"minIdle":null,"minEvictableIdleTimeMillis":null,"timeBetweenEvictionRunsMillis":null,"jdbcUrl":"jdbc:mysql://presto270db.coksdj9a4svg.us-east-1.rds.amazonaws.com/BigData","initialSize":null},{"maxIdle":null,"validationCallTimeout":null,"state":"AVAILABLE","validationQuery":null,"jdbcDriverName":"HSQL","password":"presto","maxActive":null,"poolPreparedStatements":null,"numTestsPerEvictionRun":null,"userId":"presto","name":"PrestoRepositoryDataSource","maxWait":null,"minIdle":null,"minEvictableIdleTimeMillis":null,"timeBetweenEvictionRunsMillis":null,"jdbcUrl":"jdbc:mysql://presto270db.coksdj9a4svg.us-east-1.rds.amazonaws.com/presto_hadoop","initialSize":null},{"maxIdle":null,"validationCallTimeout":null,"state":"AVAILABLE","validationQuery":null,"jdbcDriverName":"HSQL","password":"presto","maxActive":null,"poolPreparedStatements":null,"numTestsPerEvictionRun":null,"userId":"presto","name":"SnapshotDataSource","maxWait":null,"minIdle":null,"minEvictableIdleTimeMillis":null,"timeBetweenEvictionRunsMillis":null,"jdbcUrl":"jdbc:mysql://presto270db.coksdj9a4svg.us-east-1.rds.amazonaws.com/presto_hadoop","initialSize":null}],"driverclass":"com.mysql.jdbc.Driver","useAtt":true,"stmtType":{"query":true,"update":false},"@wires_execution_condition":{"expression":"","conditions":[{"lhs":"","rhs":"","operator":{"operator":"matches","opId":"matches","label":"Matches","applyTo":["string","unknown"]},"caseSensitive":false}],"cnjnct":" or "}},"foreach_2":{"inputInfo":{"inputVar":"SQL_1_out","path":"/*:records/*:record"},"resultType":"Append","resultName":"result","service":"TreasuryHAMPModCountByMSA","operation":"runMashup","serviceName":"TreasuryHAMPModCountByMSA"},"foreach_11":{"inputInfo":{"inputVar":"foreach_2_out","path":"/*:result/*:Root"},"resultType":"Merge","resultName":"result","service":"TreasuryMSAModInsert","operation":"runMashup","serviceName":"TreasuryMSAModInsert"}}]]></presto:presto-meta>
<presto:presto-meta wires_id="" name="prestoMeta_sequenceNumber"  >13</presto:presto-meta>
<presto:presto-meta wires_id="" name="prestoMeta_WiresGraphXML"  ><![CDATA[<mxGraphModel><root><MashupService label="Mashup Service" name="untitled" description="" id="0"><mxCell/></MashupService><Layer label="Default Layer" id="1"><mxCell parent="0"/></Layer><mxCell id="output_0" style="output" parent="1" vertex="true" connectable="0" label="" name="MashupOutput" description="Output of the Mashup"><mxGeometry x="600" y="120" width="40" height="40" as="geometry"><mxRectangle width="48" height="48" as="alternateBounds"/></mxGeometry></mxCell><mxCell id="inport_2" value="" style="port;image=images/wires/inport.png;align=right;imageAlign=right;spacingRight=18px;" parent="output_0" vertex="1" isPort="1" isInport="1"><mxGeometry x="0.01" y="0.4" width="16" height="16" relative="1" as="geometry"><mxPoint x="-6" y="-8" as="offset"/></mxGeometry></mxCell><mxCell id="SQL_1" style="SQL" parent="1" vertex="true" connectable="0" label="" name="Operation" description="Service Operation"><mxGeometry x="140" y="120" width="40" height="40" as="geometry"><mxRectangle width="48" height="48" as="alternateBounds"/></mxGeometry></mxCell><mxCell id="inport_3" value="" style="port;image=images/wires/inport.png;align=right;imageAlign=right;spacingRight=18px;" parent="SQL_1" vertex="1" isPort="1" isInport="1"><mxGeometry x="0.01" y="0.4" width="16" height="16" relative="1" as="geometry"><mxPoint x="-6" y="-8" as="offset"/></mxGeometry></mxCell><mxCell id="outport_4" value="" style="port;image=images/wires/outport.png;" parent="SQL_1" vertex="1" isPort="1" isInport="0"><mxGeometry x="0.92" y="0.4" width="16" height="16" relative="1" as="geometry"><mxPoint x="-8" y="-8" as="offset"/></mxGeometry></mxCell><mxCell id="foreach_2" style="foreach" parent="1" vertex="true" connectable="0" label="" name="Operation" description="Service Operation"><mxGeometry x="300" y="120" width="40" height="40" as="geometry"><mxRectangle width="48" height="48" as="alternateBounds"/></mxGeometry></mxCell><mxCell id="inport_5" value="" style="port;image=images/wires/inport.png;align=right;imageAlign=right;spacingRight=18px;" parent="foreach_2" vertex="1" isPort="1" isInport="1"><mxGeometry x="0.01" y="0.4" width="16" height="16" relative="1" as="geometry"><mxPoint x="-6" y="-8" as="offset"/></mxGeometry></mxCell><mxCell id="outport_6" value="" style="port;image=images/wires/outport.png;" parent="foreach_2" vertex="1" isPort="1" isInport="0"><mxGeometry x="0.92" y="0.4" width="16" height="16" relative="1" as="geometry"><mxPoint x="-8" y="-8" as="offset"/></mxGeometry></mxCell><mxCell id="8" parent="1" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="15" parent="1" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="17" parent="1" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="foreach_11" style="foreach" parent="1" vertex="true" connectable="0" label="" name="Operation" description="Service Operation"><mxGeometry x="450" y="120" width="40" height="40" as="geometry"><mxRectangle width="48" height="48" as="alternateBounds"/></mxGeometry></mxCell><mxCell id="inport_19" value="" style="port;image=images/wires/inport.png;align=right;imageAlign=right;spacingRight=18px;" parent="foreach_11" vertex="1" isPort="1" isInport="1"><mxGeometry x="0.01" y="0.4" width="16" height="16" relative="1" as="geometry"><mxPoint x="-6" y="-8" as="offset"/></mxGeometry></mxCell><mxCell id="outport_20" value="" style="port;image=images/wires/outport.png;" parent="foreach_11" vertex="1" isPort="1" isInport="0"><mxGeometry x="0.92" y="0.4" width="16" height="16" relative="1" as="geometry"><mxPoint x="-8" y="-8" as="offset"/></mxGeometry></mxCell><mxCell id="22" parent="1" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="23" parent="1" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="25" parent="1" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="26" parent="1" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="27" parent="1" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="28" parent="1" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="31" parent="1" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="32" value="" parent="1" source="outport_20" target="inport_2" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="33" value="" parent="1" source="outport_4" target="inport_5" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="35" parent="1" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell></root></mxGraphModel>]]></presto:presto-meta>

<output output-encoding="UTF-8"  wires_id="output_0" name="output_0" type="document" service="TreasuryMSAModInsert"/>
<variable name="SQL_1_out" type="document" default="" />


<sequence wires_id="SQL_1" wires_type="SQL">
<sql name="BigData" query="select distinct prop_geoc_cnsus_msa_cd from TreasuryHAMP where prop_geoc_cnsus_msa_cd &gt; 1;" outputvariable="SQL_1_out_sql" startRow="1" rowCount="3" fetchSize="3"/>
<assign fromvariable="SQL_1_out_sql" outputvariable="SQL_1_out" wires_id="SQL_1" name="SQL_1"/>
</sequence>
<variable name="foreach_2_out" type="document" default="" />





<variable type="document" name="foreach_2_out_dummy"><result/></variable><assign wires_id="foreach_2" wires_type="support_tag" outputvariable="foreach_2_out" fromvariable="foreach_2_out_dummy"/>
<foreach variable="record" items="$SQL_1_out/*:records/*:record" wires_id="foreach_2" name="foreach_2" outputvariable="foreach_2_out">

<variable name="inputparam_2_6" type="string" default="{$record/*:prop_geoc_cnsus_msa_cd/text()}" /><assign  fromexpr="$record/*:prop_geoc_cnsus_msa_cd/text()" outputvariable="inputparam_2_6" />
<invoke   wires_id="foreach_2" name="foreach_2" header="" service="TreasuryHAMPModCountByMSA" operation="runMashup" serviceVersion="" outputvariable="foreach_2_out_invoke" inputvariables="inputparam_2_6" />
<appendresult outputvariable="$foreach_2_out">
$foreach_2_out_invoke
</appendresult>
</foreach>




<variable type="document" name="output_0_dummy"/><assign wires_id="foreach_11" wires_type="support_tag" outputvariable="output_0" fromvariable="output_0_dummy"/>
<foreach variable="Root" items="$foreach_2_out/*:result/*:Root" wires_id="foreach_11" name="foreach_11" outputvariable="output_0">

<variable name="inputparam_6_7" type="string" default="{$Root/*:MSA_Code/text()}" /><assign  fromexpr="$Root/*:MSA_Code/text()" outputvariable="inputparam_6_7" />
<variable name="inputparam_5_8" type="string" default="{$Root/*:Mod_Count/text()}" /><assign  fromexpr="$Root/*:Mod_Count/text()" outputvariable="inputparam_5_8" />
<invoke   wires_id="foreach_11" name="foreach_11" header="" service="TreasuryMSAModInsert" operation="runMashup" serviceVersion="" outputvariable="output_0_invoke" inputvariables="inputparam_6_7,inputparam_5_8" />
<if condition="count($Root/preceding-sibling::*) + 1=1"><assign fromvariable="output_0_invoke" outputvariable="output_0"/><else><merge  inputvariables="output_0,output_0_invoke" outputvariable="$output_0"/></else></if><assign wires_id="foreach_11" fromvariable="output_0" outputvariable="output_0"/></foreach>


</operation>
</mashup>